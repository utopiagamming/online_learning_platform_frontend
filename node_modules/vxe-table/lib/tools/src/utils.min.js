"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.UtilTools=void 0;var _ctor=_interopRequireDefault(require("xe-utils/ctor")),_conf=_interopRequireDefault(require("../../conf")),_formats=_interopRequireDefault(require("../../v-x-e-table/src/formats"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var zindexIndex=0,lastZindex=1;function getColFuncWidth(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:16;return e?t:0}var ColumnInfo=function(){function p(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=r.renderHeader,l=r.renderCell,n=r.renderFooter,i=r.renderData;_classCallCheck(this,p);var a=e.$xegrid,s=a?a.proxyOpts:null,u=t.formatter,c=!_ctor.default.isBoolean(t.visible)||t.visible;if(t.cellRender&&t.editRender&&UtilTools.warn("vxe.error.errConflicts",["column.cell-render","column.edit-render"]),t.editRender&&"visible"===t.editRender.type&&UtilTools.warn("vxe.error.delProp",["column.edit-render.type","column.cell-render"]),t.prop&&UtilTools.warn("vxe.error.delProp",["column.prop","column.field"]),t.label&&UtilTools.warn("vxe.error.delProp",["column.label","column.title"]),t.class&&UtilTools.warn("vxe.error.delProp",["column.class","column.className"]),"index"===t.type?UtilTools.warn("vxe.error.delProp",["column.type=index","column.type=seq"]):"selection"===t.type?UtilTools.warn("vxe.error.delProp",["column.type=selection","column.type=checkbox"]):"expand"===t.type&&(e.treeConfig&&e.treeOpts.line&&UtilTools.error("vxe.error.errConflicts",["tree-config.line","column.type=expand"]),t.slots&&!t.slots.content&&t.slots.default&&UtilTools.error("vxe.error.expandContent")),(_ctor.default.isBoolean(t.cellRender)||t.cellRender&&!_ctor.default.isObject(t.cellRender))&&UtilTools.warn("vxe.error.errProp",["column.cell-render=".concat(t.cellRender),"column.cell-render={}"]),(_ctor.default.isBoolean(t.editRender)||t.editRender&&!_ctor.default.isObject(t.editRender))&&UtilTools.warn("vxe.error.errProp",["column.edit-render=".concat(t.editRender),"column.edit-render={}"]),t.remoteSort&&UtilTools.warn("vxe.error.delProp",["column.remote-sort","sort-config.remote"]),t.sortMethod&&UtilTools.warn("vxe.error.delProp",["column.sort-method","sort-config.sortMethod"]),t.sortBy&&!_ctor.default.isString(t.sortBy)&&UtilTools.warn("vxe.error.errProp",["column.sort-by=".concat(JSON.stringify(t.sortBy)),'column.sort-by="'.concat(t.sortBy[0],'"')]),u)if(_ctor.default.isString(u)){var d=_formats.default.get(u);!d&&_ctor.default[u]&&(d=_ctor.default[u],UtilTools.warn("vxe.error.errFormat",[u])),_ctor.default.isFunction(d)||UtilTools.error("vxe.error.notFunc",[u])}else if(_ctor.default.isArray(u)){var f=_formats.default.get(u[0]);!f&&_ctor.default[u[0]]&&(f=_ctor.default[u[0]],UtilTools.warn("vxe.error.errFormat",[u[0]])),_ctor.default.isFunction(f)||UtilTools.error("vxe.error.notFunc",[u[0]])}Object.assign(this,{type:t.type,prop:t.prop,property:t.field||t.prop,title:t.title,label:t.label,width:t.width,minWidth:t.minWidth,resizable:t.resizable,fixed:t.fixed,align:t.align,headerAlign:t.headerAlign,footerAlign:t.footerAlign,showOverflow:t.showOverflow,showHeaderOverflow:t.showHeaderOverflow,showFooterOverflow:t.showFooterOverflow,className:t.class||t.className,headerClassName:t.headerClassName,footerClassName:t.footerClassName,indexMethod:t.indexMethod,seqMethod:t.seqMethod,formatter:u,sortable:t.sortable,sortBy:t.sortBy,sortType:t.sortType,sortMethod:t.sortMethod,remoteSort:t.remoteSort,filters:UtilTools.getFilters(t.filters),filterMultiple:!_ctor.default.isBoolean(t.filterMultiple)||t.filterMultiple,filterMethod:t.filterMethod,filterResetMethod:t.filterResetMethod,filterRecoverMethod:t.filterRecoverMethod,filterRender:t.filterRender,treeNode:t.treeNode,cellType:t.cellType,cellRender:t.cellRender,editRender:t.editRender,contentRender:t.contentRender,exportMethod:t.exportMethod,footerExportMethod:t.footerExportMethod,titleHelp:t.titleHelp,params:t.params,id:t.colId||_ctor.default.uniqueId("col_"),parentId:null,visible:c,halfVisible:!1,defaultVisible:c,checked:!1,halfChecked:!1,disabled:!1,level:1,rowSpan:1,colSpan:1,order:null,sortTime:0,renderWidth:0,renderHeight:0,resizeWidth:0,renderLeft:0,renderArgs:[],model:{},renderHeader:o||t.renderHeader,renderCell:l||t.renderCell,renderFooter:n||t.renderFooter,renderData:i,slots:t.slots,_own:t}),s&&s.beforeColumn&&s.beforeColumn({$grid:a,column:this})}return _createClass(p,[{key:"getTitle",value:function(){return UtilTools.getFuncText(this.title||this.label||("seq"===this.type||"index"===this.type?_conf.default.i18n("vxe.table.seqTitle"):""))}},{key:"getKey",value:function(){return this.property||(this.type?"type=".concat(this.type):null)}},{key:"getMinWidth",value:function(){var e=this.type,t=this.filters,r=this.sortable,o=this.remoteSort,l=this.sortOpts,n=this.editRender,i=this.editOpts,a=this.titleHelp;return 40+getColFuncWidth("checkbox"===e||"selection"===e,18)+getColFuncWidth(a,18)+getColFuncWidth(t)+getColFuncWidth((r||o)&&l.showIcon)+getColFuncWidth(n&&i.showIcon,32)}},{key:"update",value:function(e,t){"filters"!==e&&(this[e]=t,"field"===e&&(this.property=t))}},{key:"own",get:function(){return console.warn('[vxe-table] This is an internal attribute "column.own". Please pay attention to locking the version number to avoid errors caused by upgrade.'),this._own}}]),p}();function outLog(o){return function(e,t){var r=UtilTools.getLog(e,t);return console[o](r),r}}var UtilTools={warn:outLog("warn"),error:outLog("error"),getLog:function(e,t){return"[vxe-table] ".concat(_conf.default.i18n(e,t))},getFuncText:function(e){return _ctor.default.isFunction(e)?e():_conf.default.translate?_conf.default.translate(e):e},nextZIndex:function(){return lastZindex=_conf.default.zIndex+zindexIndex++},getLastZIndex:function(){return lastZindex},getRowkey:function(e){return e.rowId||"_XID"},getRowid:function(e,t){var r=_ctor.default.get(t,UtilTools.getRowkey(e));return _ctor.default.eqNull(r)?"":encodeURIComponent(r)},getColumnList:function(e){var t=[];return e.forEach(function(e){t.push.apply(t,_toConsumableArray(e.children&&e.children.length?UtilTools.getColumnList(e.children):[e]))}),t},getClass:function(e,t){return e?_ctor.default.isFunction(e)?e(t):e:""},getFilters:function(e){return e&&_ctor.default.isArray(e)?e.map(function(e){var t=e.label,r=e.value,o=e.data,l=e.resetValue,n=e.checked;return{label:t,value:r,data:o,resetValue:l,checked:!!n,_checked:!!n}}):e},formatText:function(e,t){return""+(""===e||null==e?t?_conf.default.emptyCell:"":e)},getCellValue:function(e,t){return _ctor.default.get(e,t.property)},setCellValue:function(e,t,r){return _ctor.default.set(e,t.property,r)},isColumn:function(e){return e instanceof ColumnInfo},getColumnConfig:function(e,t,r){return UtilTools.isColumn(t)?t:new ColumnInfo(e,t,r)},assemColumn:function(e){var t=e.$el,r=e.$xetable,o=e.$xecolumn,l=e.columnConfig,n=o?o.columnConfig:null;l.slots=e.$scopedSlots,n?("vxe-table-column"===o.$options._componentTag?UtilTools.warn("vxe.error.groupTag",["<vxe-table-colgroup title=".concat(o.title," ...>"),"<vxe-table-column title=".concat(o.title," ...>")]):"vxe-column"===o.$options._componentTag&&UtilTools.warn("vxe.error.groupTag",["<vxe-colgroup title=".concat(o.title," ...>"),"<vxe-column title=".concat(o.title," ...>")]),n.children||(n.children=[]),n.children.splice([].indexOf.call(o.$el.children,t),0,l)):r.collectColumn.splice([].indexOf.call(r.$refs.hideColumn.children,t),0,l)},destroyColumn:function(e){var t=e.$xetable,r=e.columnConfig,o=_ctor.default.findTree(t.collectColumn,function(e){return e===r});o&&o.items.splice(o.index,1)},hasChildrenList:function(e){return e&&e.children&&0<e.children.length},getColMinWidth:function(e){var t=e.$table,r=e.column,o=t.showHeaderOverflow,l=t.resizableOpts,n=t.sortOpts,i=t.filterOpts,a=t.editOpts,s=r.type,u=r.showHeaderOverflow,c=r.filters,d=r.sortable,f=r.remoteSort,p=r.titleHelp,h=r.editRender,m=l.minWidth;if(m){var y=_ctor.default.isFunction(m)?m(e):m;if("auto"!==y)return Math.max(1,_ctor.default.toNumber(y))}var g=_ctor.default.isUndefined(u)||_ctor.default.isNull(u)?o:u,v=40;return("title"===g||(!0===g||"tooltip"===g)||"ellipsis"===g)&&(v+=getColFuncWidth("checkbox"===s||"selection"===s,18)+getColFuncWidth(p,18)+getColFuncWidth(c&&i.showIcon)+getColFuncWidth((d||f)&&n.showIcon)+getColFuncWidth(UtilTools.isEnableConf(h)&&a.showIcon,32)),v},parseFile:function(e){var t=e.name,r=_ctor.default.lastIndexOf(t,"."),o=t.substring(r+1,t.length);return{filename:t.substring(0,r),type:o}},isNumVal:function(e){return!isNaN(parseFloat(""+e))},isEnableConf:function(e){return e&&!1!==e.enabled},eqEmptyValue:function(e){return""===e||_ctor.default.eqNull(e)}},_default=exports.UtilTools=UtilTools;exports.default=_default;