"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ctor=_interopRequireDefault(require("xe-utils/ctor")),_conf=_interopRequireDefault(require("../../conf")),_vXETable=_interopRequireDefault(require("../../v-x-e-table")),_tools=require("../../tools");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _defineProperty(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function renderBtns(l,c){var a=c._e,t=c.$scopedSlots,u=c.$xegrid,h=c.$xetable,e=c.buttons,o=void 0===e?[]:e;return t.buttons?t.buttons.call(c,{$grid:u,$table:h},l):o.map(function(e){var t=e.name,o=e.visible,n=e.dropdowns,i=e.buttonRender,s=i?_vXETable.default.renderer.get(i.name):null;if(!1===o)return a();if(s){var r=s.renderToolbarButton||s.renderButton;if(r)return l("span",{class:"vxe-button--item"},r.call(c,l,i,{$grid:u,$table:h,button:e},{$grid:u,$table:h}))}return l("vxe-button",{on:{click:function(t){return c.btnEvent(t,e)}},props:{disabled:e.disabled,loading:e.loading,type:e.type,icon:e.icon,circle:e.circle,round:e.round,status:e.status,destroyOnClose:e.destroyOnClose,placement:e.placement,transfer:e.transfer},scopedSlots:n&&n.length?{default:function(){return _tools.UtilTools.getFuncText(t)},dropdowns:function(){return n.map(function(e){return!1===e.visible?a():l("vxe-button",{on:{click:function(t){return c.btnEvent(t,e)}},props:{disabled:e.disabled,loading:e.loading,type:e.type,icon:e.icon,circle:e.circle,round:e.round,status:e.status}},_tools.UtilTools.getFuncText(e.name))})}}:null},_tools.UtilTools.getFuncText(t))})}function renderRightTools(t,e){var o=e.$scopedSlots,n=e.$xegrid,i=e.$xetable;return o.tools?o.tools.call(e,{$grid:n,$table:i},t):[]}function renderCustoms(s,r){var t=r.$xetable,e=r.customStore,o=r.customOpts,n=r.columns,l=[],i={},c={},a=(t&&t.customOpts?t.customOpts.checkMethod:null)||o.checkMethod;return"manual"===o.trigger||("hover"===o.trigger?(i.mouseenter=r.handleMouseenterSettingEvent,i.mouseleave=r.handleMouseleaveSettingEvent,c.mouseenter=r.handleWrapperMouseenterEvent,c.mouseleave=r.handleWrapperMouseleaveEvent):i.click=r.handleClickSettingEvent),_ctor.default.eachTree(n,function(t){var e=_tools.UtilTools.formatText(t.getTitle(),1),o=t.getKey(),n=t.children&&t.children.length,i=!!a&&!a({column:t});(n||o)&&l.push(s("li",{class:["vxe-custom--option","level--".concat(t.level),{"is--group":n,"is--checked":t.visible,"is--indeterminate":t.halfVisible,"is--disabled":i}],attrs:{title:e},on:{click:function(){i||r.changeCustomOption(t)}}},[s("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),s("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),s("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"}),s("span",{class:"vxe-checkbox--label"},e)]))}),s("div",{class:["vxe-custom--wrapper",{"is--active":e.visible}],ref:"customWrapper"},[s("vxe-button",{props:{circle:!0,icon:o.icon||_conf.default.icon.TOOLBAR_TOOLS_CUSTOM},attrs:{title:_conf.default.i18n("vxe.toolbar.custom")},on:i}),s("div",{class:"vxe-custom--option-wrapper"},[s("ul",{class:"vxe-custom--header"},[s("li",{class:["vxe-custom--option",{"is--checked":e.isAll,"is--indeterminate":e.isIndeterminate}],attrs:{title:_conf.default.i18n("vxe.table.allTitle")},on:{click:r.allCustomEvent}},[s("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),s("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),s("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"}),s("span",{class:"vxe-checkbox--label"},_conf.default.i18n("vxe.toolbar.customAll"))])]),s("ul",{class:"vxe-custom--body",on:c},l),!1===o.isFooter?null:s("div",{class:"vxe-custom--footer"},[s("button",{class:"btn--confirm",on:{click:r.confirmCustomEvent}},_conf.default.i18n("vxe.toolbar.customConfirm")),s("button",{class:"btn--reset",on:{click:r.resetCustomEvent}},_conf.default.i18n("vxe.toolbar.customRestore"))])])])}var _default2={name:"VxeToolbar",props:{id:String,loading:Boolean,resizable:[Boolean,Object],refresh:[Boolean,Object],import:[Boolean,Object],export:[Boolean,Object],print:[Boolean,Object],zoom:[Boolean,Object],setting:[Boolean,Object],custom:[Boolean,Object],buttons:{type:Array,default:function(){return _conf.default.toolbar.buttons}},perfect:{type:Boolean,default:function(){return _conf.default.toolbar.perfect}},size:{type:String,default:function(){return _conf.default.toolbar.size||_conf.default.size}}},inject:{$xegrid:{default:null}},data:function(){return{$xetable:null,isRefresh:!1,columns:[],customStore:{isAll:!1,isIndeterminate:!1,visible:!1}}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize},refreshOpts:function(){return Object.assign({},_conf.default.toolbar.refresh,this.refresh)},importOpts:function(){return Object.assign({},_conf.default.toolbar.import,this.import)},exportOpts:function(){return Object.assign({},_conf.default.toolbar.export,this.export)},printOpts:function(){return Object.assign({},_conf.default.toolbar.print,this.print)},resizableOpts:function(){return Object.assign({},_conf.default.toolbar.resizable,this.resizable)},zoomOpts:function(){return Object.assign({},_conf.default.toolbar.zoom,this.zoom)},customOpts:function(){return Object.assign({},_conf.default.toolbar.custom,this.custom)}},created:function(){var e=this,t=this.customOpts,o=this.refresh,n=this.resizable,i=this.setting,s=this.id,r=this.refreshOpts;if(t.storage&&!s)return _tools.UtilTools.error("vxe.error.reqProp",["toolbar.id"]);s&&_tools.UtilTools.warn("vxe.error.removeProp",["toolbar.id"]),i&&_tools.UtilTools.warn("vxe.error.delProp",["toolbar.setting","toolbar.custom"]),_vXETable.default._export||!this.export&&!this.import||_tools.UtilTools.error("vxe.error.reqModule",["Export"]),n&&_tools.UtilTools.warn("vxe.error.delProp",["toolbar.resizable","custom-config.storage"]),t.storage&&_tools.UtilTools.warn("vxe.error.delProp",["toolbar.custom.storage","custom-config.storage"]),this.$nextTick(function(){var t=e.fintTable();!o||e.$xegrid||r.query||_tools.UtilTools.warn("vxe.error.notFunc",["query"]),t&&t.connect(e)}),_tools.GlobalEvent.on(this,"mousedown",this.handleGlobalMousedownEvent),_tools.GlobalEvent.on(this,"blur",this.handleGlobalBlurEvent)},destroyed:function(){_tools.GlobalEvent.off(this,"mousedown"),_tools.GlobalEvent.off(this,"blur")},render:function(t){var e,o=this.$xegrid,n=this.perfect,i=this.loading,s=this.importOpts,r=this.exportOpts,l=this.refresh,c=this.refreshOpts,a=this.zoom,u=this.zoomOpts,h=this.custom,f=this.setting,d=this.vSize;return t("div",{class:["vxe-toolbar",(e={},_defineProperty(e,"size--".concat(d),d),_defineProperty(e,"is--perfect",n),_defineProperty(e,"is--loading",i),e)]},[t("div",{class:"vxe-buttons--wrapper"},renderBtns(t,this)),t("div",{class:"vxe-tools--wrapper"},renderRightTools(t,this)),t("div",{class:"vxe-tools--operate"},[this.import?t("vxe-button",{props:{circle:!0,icon:s.icon||_conf.default.icon.TOOLBAR_TOOLS_IMPORT},attrs:{title:_conf.default.i18n("vxe.toolbar.import")},on:{click:this.importEvent}}):null,this.export?t("vxe-button",{props:{circle:!0,icon:r.icon||_conf.default.icon.TOOLBAR_TOOLS_EXPORT},attrs:{title:_conf.default.i18n("vxe.toolbar.export")},on:{click:this.exportEvent}}):null,this.print?t("vxe-button",{props:{circle:!0,icon:this.printOpts.icon||_conf.default.icon.TOOLBAR_TOOLS_PRINT},attrs:{title:_conf.default.i18n("vxe.toolbar.print")},on:{click:this.printEvent}}):null,l?t("vxe-button",{props:{circle:!0,icon:this.isRefresh?c.iconLoading||_conf.default.icon.TOOLBAR_TOOLS_REFRESH_LOADING:c.icon||_conf.default.icon.TOOLBAR_TOOLS_REFRESH},attrs:{title:_conf.default.i18n("vxe.toolbar.refresh")},on:{click:this.refreshEvent}}):null,a&&o?t("vxe-button",{props:{circle:!0,icon:o.isMaximized()?u.iconOut||_conf.default.icon.TOOLBAR_TOOLS_ZOOM_OUT:u.iconIn||_conf.default.icon.TOOLBAR_TOOLS_ZOOM_IN},attrs:{title:_conf.default.i18n("vxe.toolbar.zoom".concat(o.isMaximized()?"Out":"In"))},on:{click:o.triggerZoomEvent}}):null,h||f?renderCustoms(t,this):null])])},methods:{syncUpdate:function(t){var e=t.collectColumn,o=t.$table;this.$xetable=o,this.columns=e},fintTable:function(){var t=this.$parent.$children,o=t.indexOf(this);return _ctor.default.find(t,function(t,e){return t&&t.refreshColumn&&o<e&&"vxe-table"===t.$vnode.componentOptions.tag})},checkTable:function(){if(this.$xetable)return!0;_tools.UtilTools.error("vxe.error.barUnableLink")},showCustom:function(){this.customStore.visible=!0,this.checkCustomStatus()},closeCustom:function(){var t=this.custom,e=this.setting,o=this.customStore;o.visible&&(o.visible=!1,!t&&!e||o.immediate||this.handleCustoms())},confirmCustomEvent:function(t){this.closeCustom(),this.emitCustomEvent("confirm",t)},customOpenEvent:function(t){var e=this.customStore;this.checkTable()&&(e.visible||(this.showCustom(),this.emitCustomEvent("open",t)))},customColseEvent:function(t){this.customStore.visible&&(this.closeCustom(),this.emitCustomEvent("close",t))},resetCustomEvent:function(t){var e=this.$xetable,o=this.columns,n=this.customOpts,i=e.customOpts.checkMethod||n.checkMethod;_ctor.default.eachTree(o,function(t){i&&!i({column:t})||(t.visible=t.defaultVisible,t.halfVisible=!1),t.resizeWidth=0}),e.saveCustomResizable(!0),this.closeCustom(),this.emitCustomEvent("reset",t)},emitCustomEvent:function(t,e){var o=this.$xetable,n=this.$xegrid;(n||o).$emit("custom",{type:t,$table:o,$grid:n,$event:e},e)},changeCustomOption:function(t){var e=!t.visible;_ctor.default.eachTree([t],function(t){t.visible=e,t.halfVisible=!1}),this.handleOptionCheck(t),this.custom&&this.customOpts.immediate&&this.handleCustoms(),this.checkCustomStatus()},handleOptionCheck:function(e){var t=_ctor.default.findTree(this.columns,function(t){return t===e});if(t&&t.parent){var o=t.parent;o.children&&o.children.length&&(o.visible=o.children.every(function(t){return t.visible}),o.halfVisible=!o.visible&&o.children.some(function(t){return t.visible||t.halfVisible}),this.handleOptionCheck(o))}},handleCustoms:function(){var t=this.$xetable;t.saveCustomVisible(),t.analyColumnWidth(),t.refreshColumn()},checkCustomStatus:function(){var t=this.$xetable,e=this.columns,o=this.customOpts,n=t.customOpts.checkMethod||o.checkMethod;this.customStore.isAll=e.every(function(t){return!!n&&!n({column:t})||t.visible}),this.customStore.isIndeterminate=!this.customStore.isAll&&e.some(function(t){return(!n||n({column:t}))&&(t.visible||t.halfVisible)})},allCustomEvent:function(){var t=this.$xetable,e=this.columns,o=this.customOpts,n=this.customStore,i=t.customOpts.checkMethod||o.checkMethod,s=!n.isAll;_ctor.default.eachTree(e,function(t){i&&!i({column:t})||(t.visible=s,t.halfVisible=!1)}),n.isAll=s,this.checkCustomStatus()},handleGlobalMousedownEvent:function(t){_tools.DomTools.getEventTargetNode(t,this.$refs.customWrapper).flag||this.customColseEvent(t)},handleGlobalBlurEvent:function(t){this.customColseEvent(t)},handleClickSettingEvent:function(t){this.customStore.visible?this.customColseEvent(t):this.customOpenEvent(t)},handleMouseenterSettingEvent:function(t){this.customStore.activeBtn=!0,this.customOpenEvent(t)},handleMouseleaveSettingEvent:function(t){var e=this,o=this.customStore;o.activeBtn=!1,setTimeout(function(){o.activeBtn||o.activeWrapper||e.customColseEvent(t)},300)},handleWrapperMouseenterEvent:function(t){this.customStore.activeWrapper=!0,this.customOpenEvent(t)},handleWrapperMouseleaveEvent:function(t){var e=this,o=this.customStore;o.activeWrapper=!1,setTimeout(function(){o.activeBtn||o.activeWrapper||e.customColseEvent(t)},300)},refreshEvent:function(){var t=this,e=this.$xegrid,o=this.refreshOpts;if(!this.isRefresh)if(o.query){this.isRefresh=!0;try{Promise.resolve(o.query()).catch(function(t){return t}).then(function(){t.isRefresh=!1})}catch(t){this.isRefresh=!1}}else e&&(this.isRefresh=!0,e.commitProxy("reload").catch(function(t){return t}).then(function(){t.isRefresh=!1}))},btnEvent:function(t,e){var o=this.$xegrid,n=this.$xetable,i=e.code;if(i)if(o)o.triggerToolbarBtnEvent(e,t);else{var s=_vXETable.default.commands.get(i),r={code:i,button:e,$xegrid:o,$table:n,$event:t};s&&s.call(this,r,t),this.$emit("button-click",r,t)}},importEvent:function(){this.checkTable()&&this.$xetable.openImport(this.importOpts)},exportEvent:function(){this.checkTable()&&this.$xetable.openExport(this.exportOpts)},printEvent:function(){this.checkTable()&&this.$xetable.print(this.printOpts)}}};exports.default=_default2;