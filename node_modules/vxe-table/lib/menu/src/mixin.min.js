"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ctor=_interopRequireDefault(require("xe-utils/ctor")),_tools=require("../../tools"),_vXETable=_interopRequireDefault(require("../../v-x-e-table"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default={methods:{_closeMenu:function(){return Object.assign(this.ctxMenuStore,{visible:!1,selected:null,selectChild:null,showChild:!1}),this.$nextTick()},moveCtxMenu:function(e,t,o,i,n,l,s){var r,c=_ctor.default.findIndexOf(s,function(e){return o[i]===e});if(t===n)l&&_tools.UtilTools.hasChildrenList(o.selected)?o.showChild=!0:(o.showChild=!1,o.selectChild=null);else if(38===t){for(var u=c-1;0<=u;u--)if(!1!==s[u].visible){r=s[u];break}o[i]=r||s[s.length-1]}else if(40===t){for(var a=c+1;a<s.length;a++)if(!1!==s[a].visible){r=s[a];break}o[i]=r||s[0]}else!o[i]||13!==t&&32!==t||this.ctxMenuLinkEvent(e,o[i])},handleGlobalContextmenuEvent:function(e){var t=this.$refs,o=this.tId,i=this.editStore,n=this.menuConfig,l=this.contextMenu,s=this.ctxMenuStore,r=this.ctxMenuOpts,c=this.mouseConfig,u=this.mouseOpts,a=i.selected,h=["header","body","footer"];if(n||l){if(s.visible&&t.ctxWrapper&&_tools.DomTools.getEventTargetNode(e,t.ctxWrapper.$el).flag)return void e.preventDefault();if(this._keyCtx){var d="body",f={type:d,$grid:this.$xegrid,$table:this,keyboard:!0,columns:this.visibleColumn.slice(0),$event:e};if(c&&u.area){var v=this.getActiveCellArea();if(v&&v.row&&v.column)return f.row=v.row,f.column=v.column,void this.openContextMenu(e,d,f)}else if(c&&u.selected&&a.row&&a.column)return f.row=a.row,f.column=a.column,void this.openContextMenu(e,d,f)}for(var g=0;g<h.length;g++){var x=h[g],p=_tools.DomTools.getEventTargetNode(e,this.$el,"vxe-".concat(x,"--column"),function(e){return e.parentNode.parentNode.parentNode.getAttribute("data-tid")===o}),m={type:x,$grid:this.$xegrid,$table:this,columns:this.visibleColumn.slice(0),$event:e};if(p.flag){var b=p.targetElem,M=this.getColumnNode(b).item,C="".concat(x,"-");if(Object.assign(m,{column:M,columnIndex:this.getColumnIndex(M),cell:b}),"body"===x){var _=this.getRowNode(b.parentNode).item;C="",m.row=_,m.rowIndex=this.getRowIndex(_)}return this.openContextMenu(e,x,m),void(this.$listeners["".concat(C,"cell-context-menu")]?(_tools.UtilTools.warn("vxe.error.delEvent",["".concat(C,"cell-context-menu"),"".concat(C,"cell-menu")]),this.emitEvent("".concat(C,"cell-context-menu"),m,e)):this.emitEvent("".concat(C,"cell-menu"),m,e))}if(_tools.DomTools.getEventTargetNode(e,this.$el,"vxe-table--".concat(x,"-wrapper"),function(e){return e.getAttribute("data-tid")===o}).flag)return void("cell"===r.trigger?e.preventDefault():this.openContextMenu(e,x,m))}}t.filterWrapper&&!_tools.DomTools.getEventTargetNode(e,t.filterWrapper.$el).flag&&this.closeFilter(),this.closeMenu()},openContextMenu:function(o,e,i){var f=this,t=this.isCtxMenu,v=this.ctxMenuStore,n=this.ctxMenuOpts,l=n[e],g=n.visibleMethod;if(l){var x=l.options;l.disabled?o.preventDefault():t&&x&&x.length&&(i.options=x,this.preventEvent(o,"event.showMenu",i,function(){if(!g||g(i,o)){o.preventDefault(),f.updateZindex();var e=_tools.DomTools.getDomNode(),s=e.scrollTop,r=e.scrollLeft,c=e.visibleHeight,u=e.visibleWidth,a=o.clientY+s,h=o.clientX+r,n=function(){Object.assign(v,{args:i,visible:!0,list:x,selected:null,selectChild:null,showChild:!1,style:{zIndex:f.tZindex,top:"".concat(a,"px"),left:"".concat(h,"px")}}),f.$nextTick(function(){var e=f.$refs.ctxWrapper.$el,t=e.clientHeight,o=e.clientWidth,i=_tools.DomTools.getAbsolutePos(e),n=i.boundingTop,l=i.boundingLeft+o-u;-10<n+t-c&&(v.style.top="".concat(Math.max(s+2,a-t-2),"px")),-10<l&&(v.style.left="".concat(Math.max(r+2,h-o-2),"px"))})},t=i.keyboard,l=i.row,d=i.column;t&&l&&d?f.scrollToRow(l,d).then(function(){var e=f.getCell(l,d),t=_tools.DomTools.getAbsolutePos(e),o=t.boundingTop,i=t.boundingLeft;a=o+s+Math.floor(e.offsetHeight/2),h=i+r+Math.floor(e.offsetWidth/2),n()}):n()}else f.closeMenu()}))}this.closeFilter()},ctxMenuMouseoverEvent:function(e,t,o){var h=e.currentTarget,i=this.ctxMenuStore;e.preventDefault(),e.stopPropagation(),i.selected=t,(i.selectChild=o)||(i.showChild=_tools.UtilTools.hasChildrenList(t),i.showChild&&this.$nextTick(function(){var e=h.nextElementSibling;if(e){var t=_tools.DomTools.getAbsolutePos(h),o=t.boundingTop,i=t.boundingLeft,n=t.visibleHeight,l=t.visibleWidth,s=o+h.offsetHeight,r="",c="";i+h.offsetWidth+e.offsetWidth>l-10&&(r="auto",c="".concat(h.offsetWidth,"px"));var u="",a="";s+e.offsetHeight>n-10&&(u="auto",a="0"),e.style.left=r,e.style.right=c,e.style.top=u,e.style.bottom=a}}))},ctxMenuMouseoutEvent:function(e,t){var o=this.ctxMenuStore;t.children||(o.selected=null),o.selectChild=null},ctxMenuLinkEvent:function(e,t){if(!t.disabled&&(t.code||!t.children||!t.children.length)){var o=_vXETable.default.menus.get(t.code),i=Object.assign({menu:t,$grid:this.$xegrid,$table:this,$event:e},this.ctxMenuStore.args);o&&o.call(this,i,e),this.$listeners["context-menu-click"]?(_tools.UtilTools.warn("vxe.error.delEvent",["context-menu-click","menu-click"]),this.emitEvent("context-menu-click",i,e)):this.emitEvent("menu-click",i,e),this.closeMenu()}}}};exports.default=_default;